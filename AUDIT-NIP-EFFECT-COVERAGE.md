# NIP Effect Service Test Coverage Audit (nostr-effect-997.3)

## Summary
Audited `src/wrappers/*.test.ts` (pure/Promise NIP helpers) vs Effect services in `src/client/*Service.ts` and `src/relay/core/nip/modules/*Module.ts`.

**Key Finding**: Good progress! Recent beads added Effect-level tests for:
- `Nip05Service` (fetch + parse)
- Relay modules: `Nip01`, `Nip11`, `Nip16`, `Nip28`, `Nip42`, `Nip50`
- `Nip46Service` (URL parsing/validation)
- `Nip10Service` (thread parsing - pure but comprehensive)

Most wrappers tests are pure functions (good for utils). Effect services with external deps (fetch, crypto) now have `Effect.gen` + `runPromise/Sync` harnesses.

**Coverage Matrix**:
| Wrapper Test | Effect Service Test | Status |
|--------------|---------------------|--------|
| nip03.test.ts | - | Utility (pure OK) |
| nip07.test.ts | - | Browser signing (client-side) |
| nip08.test.ts | - | Relay hints (Nip01 covers basics) |
| nip19.test.ts | - | Bech32 utils (pure OK) |
| nip37.test.ts | - | Direct messages - **GAP: Nip37Service?** |
| nip73.test.ts | Nip16Module.test.ts | Covered (POW replaceable) |
| nip96.test.ts | - | HTTP auth - **GAP** |
| ... | Nip05Service.test.ts | ✅ Effect fetch |
| - | Nip17Service.test.ts | Exists but check Effect? |
| - | Nip46Service.test.ts | ✅ Effect parsing |

**Total**:
- 26 wrapper tests (pure/Promise)
- 35+ client service tests (mix pure/Effect)
- 7 relay module tests (Effect/policy)

## Missing Effect Mirrors (Prioritized)
Services with Effect code (fetch/WS/crypto) lacking full `runPromise` coverage mirroring wrappers:

1. **Nip17Service** (poast threads) - Has .test.ts but verify Effect fetch.
2. **Nip25Service** (zap reactions) - Effect parsing needed.
3. **Nip51Service** (lists) - Complex Effect ops.
4. **Nip58Service** (badges) - Fetch validation.
5. **RelayService** / **RelayPool** - Core WS, partial coverage.
6. **Nip96 HTTP Auth** - New service?
7. Remaining relay modules: Nip09,15,20,40,45,57,62,70,77,86,A0,B0 (no tests)

## Next Steps (Child Beads Created)
Created follow-up tasks under epic nostr-effect-997.

Generated by MechaCoder